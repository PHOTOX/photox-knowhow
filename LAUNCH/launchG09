#!/bin/bash

if [[ $# -lt "2" ]] || [[ "$1" = "-h" ]]; then
	echo "USAGE: 'launchG09 input.com queue' "
	exit 1
fi

PWD=$(pwd)
input=$1

# automatically determine number of processors
nproc=`grep proc $input  | head -1 | awk -F "=" '{if($2!=""){printf"%i",$2}}'`
 if [[ $nproc == "" ]];then
	 # we should ideally use regural expression, but NAH
nproc=`grep Proc $input  | head -1 | awk -F "=" '{if($2!=""){printf"%i",$2}}'`
 fi
 if [[ $nproc == "" ]];then
	 echo "Error: Could not determine the number of processors."
	 echo "Please set Nprocshared=x in Gaussian input file."
	 exit 1
 fi


cat > r.$input << EOF
#!/bin/bash

#$ -cwd
#$ -e .
#$ -o .
#$ -V

G09 $input
EOF

echo "Launching G09 job."
echo "$nproc proccesors will be used." 


echo "qsub -cwd -q $2 -pe shm $nproc r.$input"
qsub -cwd -q $2 -pe shm $nproc r.$input

