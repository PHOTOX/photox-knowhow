#!/bin/bash
function PrintHelp {
   echo " "
   echo "USAGE: 'launchNWCHEM input.com queue [number_of_cpus]' "
   exit 1
}

if [[ $# -lt "2" ]]; then
   echo "Not enough parameters."
   PrintHelp
fi

input=$1
queue=$2

if [[ ! -z $3 ]];then
   nproc=$3
else
   nproc=1
fi

if [[ ! -e "$input" ]];then
   echo "File $input does not exist. Exiting."
   PrintHelp
fi

if [ "`echo ${nproc} | grep '^[0-9]*$'`" != ${nproc} ]; then
    echo "Error: number_of_cpus parameter is not a number!"
    PrintHelp
fi

cat > r.$input << EOF
#!/bin/bash

#$ -cwd
#$ -e .
#$ -o .
#$ -V

NWCHEM $input $nproc
EOF

if [[ "nproc" -gt 1 ]];then
   echo "Submitting Nwchem job for parallel execution in ${queue} queue with ${ncpus} processes."
   echo "qsub -cwd -q $queue -pe mpi_alt $nproc r.$input"
   qsub -cwd -q $queue -pe mpi_alt $nproc r.$input
else
   echo "Launching single-processor Nwchem job."
   echo "qsub -cwd -q $queue r.$input"
   qsub -cwd -q $queue r.$input
fi

