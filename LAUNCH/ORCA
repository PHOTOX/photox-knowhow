#!/bin/bash

input=$1
version=$2
# Also sets the MPI environment
source SetEnvironment.sh ORCA $version
if [[ $? != "0" ]];then
   echo "Error when exporting ORCA parameters in SetEnvironment.sh"
   exit 1
fi

KDE=$(pwd)


input=$(basename $input .inp)
input=$(basename $input .com)
export PATH=$orcaroot:$PATH
export SCRDIR="/scratch/$USER/ORCA-$input-${JOB_ID}"

echo "NODE  $node" > job.log.${JOB_ID}
echo "SCRATCH  $SCRDIR" >> job.log.${JOB_ID}

mkdir -p $SCRDIR
cp $1 $SCRDIR
cd $SCRDIR
echo "Running ORCA job $1"
uname -n
date
$ORCAEXE $1 &> $KDE/$1.out 
/bin/rm -rf *.tmp*
cp * $KDE
if [[ $? -ne "0" ]];then
   echo "Error when copying the data from scratch back to the server."
   echo "I will keep the directory $SCRDIR on node:"
   uname -a
   exit 1
fi
cd ../
/bin/rm -rf $SCRDIR


